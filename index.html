<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>District 9 Pixel Exploration</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
  <style>
    body { margin: 0; }
    canvas { display: block; margin: auto; }

    /* 虚拟按钮样式 */
    #controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: grid;
      grid-template-columns: 60px 60px 60px;
      grid-template-rows: 60px 60px;
      gap: 10px;
      justify-items: center;
      align-items: center;
      z-index: 10;
    }
    #controls button {
      font-size: 24px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      background: rgba(0,0,0,0.4);
      color: white;
    }
  </style>
</head>
<body>

<!-- 手机端虚拟按钮 -->
<div id="controls">
  <div></div>
  <button id="up">↑</button>
  <div></div>
  <button id="left">←</button>
  <button id="down">↓</button>
  <button id="right">→</button>
</div>

<script>
class District9Scene extends Phaser.Scene {
  constructor() {
    super("District9Scene");
  }

  create() {
    // 背景
    this.add.rectangle(400, 300, 800, 600, 0x77dd77);

    // 玩家
    this.player = this.add.rectangle(100, 100, 20, 20, 0x3366ff);
    this.physics.add.existing(this.player);
    this.player.body.setCollideWorldBounds(true);

    // 区域
    this.zones = [
      { name: "Exposition Park", x: 200, y: 150, w: 100, h: 100,
        text: "🚁 Drone: This is Exposition Park.\nOnly 0.33 acres of recreation per 1000 residents.\nPeople want safer, greener spaces." },
      { name: "Old Apartment", x: 600, y: 150, w: 100, h: 100,
        text: "🚁 Drone: Old apartments here are overcrowded.\n68% of households are cost-burdened, 41% severely.\nHousing is a major struggle." },
      { name: "Fast Food Street", x: 200, y: 450, w: 120, h: 100,
        text: "🚁 Drone: Fast food is everywhere.\nObesity is 33%, diabetes 13%.\nHealthy food is hard to access." },
      { name: "Bus Stop", x: 600, y: 450, w: 100, h: 100,
        text: "🚁 Drone: This bus stop is crowded and unreliable.\nTransportation affects how people access jobs and health." }
    ];

    this.zones.forEach(z => {
      let zone = this.add.rectangle(z.x, z.y, z.w, z.h, 0xffcc00, 0.4);
      this.physics.add.existing(zone, true);
      this.physics.add.overlap(this.player, zone, () => this.showMessage(z.text), null, this);
    });

    // 键盘
    this.cursors = this.input.keyboard.createCursorKeys();

    // 虚拟按钮状态
    this.mobileInput = { up: false, down: false, left: false, right: false };

    // 虚拟按钮绑定
    document.getElementById("up").addEventListener("touchstart", () => this.mobileInput.up = true);
    document.getElementById("up").addEventListener("touchend", () => this.mobileInput.up = false);

    document.getElementById("down").addEventListener("touchstart", () => this.mobileInput.down = true);
    document.getElementById("down").addEventListener("touchend", () => this.mobileInput.down = false);

    document.getElementById("left").addEventListener("touchstart", () => this.mobileInput.left = true);
    document.getElementById("left").addEventListener("touchend", () => this.mobileInput.left = false);

    document.getElementById("right").addEventListener("touchstart", () => this.mobileInput.right = true);
    document.getElementById("right").addEventListener("touchend", () => this.mobileInput.right = false);

    // 信息框
    this.message = this.add.text(20, 560,
      "🚁 Drone: Explore District 9.\nWalk into yellow areas to learn about issues.", {
      font: "16px Arial",
      fill: "#000",
      backgroundColor: "#fff",
      padding: { x: 8, y: 8 }
    }).setScrollFactor(0);
  }

  update() {
    const speed = 150;
    this.player.body.setVelocity(0);

    // 键盘 + 手机输入
    if (this.cursors.left.isDown || this.mobileInput.left) this.player.body.setVelocityX(-speed);
    if (this.cursors.right.isDown || this.mobileInput.right) this.player.body.setVelocityX(speed);
    if (this.cursors.up.isDown || this.mobileInput.up) this.player.body.setVelocityY(-speed);
    if (this.cursors.down.isDown || this.mobileInput.down) this.player.body.setVelocityY(speed);
  }

  showMessage(text) {
    this.message.setText(text);
  }
}

const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  backgroundColor: "#aaddff",
  physics: { default: "arcade" },
  scene: District9Scene
};

const game = new Phaser.Game(config);
</script>

</body>
</html>